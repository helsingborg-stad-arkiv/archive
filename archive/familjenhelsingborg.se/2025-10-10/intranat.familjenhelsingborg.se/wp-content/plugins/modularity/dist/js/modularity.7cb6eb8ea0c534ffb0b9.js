(()=>{"use strict";var t={4590:(t,e)=>{e.A=class{constructor(){Object.defineProperty(this,"modalContainer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"body",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"isOpen",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.modalContainer=null,this.body=document.body,this.isOpen=!1,this.handleEvents()}createModalContent(t){return`\n            <div class="modularity-modal-wrapper">\n                <button class="modularity-modal-close" data-modularity-modal-action="close">&times; ${modularityAdminLanguage.close}</button>\n                <div class="modularity-modal-spinner-container" id="modularity-iframe-loader"><span class="modularity-modal-spinner"></span></div>\n                <iframe class="modularity-modal-iframe" src="${t}" frameborder="0" allowtransparency></iframe>\n            </div>\n        `}open(t){this.modalContainer=document.createElement("div"),this.modalContainer.id="modularity-modal",this.modalContainer.innerHTML=this.createModalContent(t),this.body.appendChild(this.modalContainer),this.body.classList.add("modularity-modal-open"),this.isOpen=!0}close(){this.modalContainer&&(this.body.removeChild(this.modalContainer),this.body.classList.remove("modularity-modal-open"),this.isOpen=!1)}handleEvents(){this.body.addEventListener("click",(t=>{const e=t.target;e&&"close"===e.getAttribute("data-modularity-modal-action")&&(t.preventDefault(),this.close())}))}}}},e={};let i=null;function o(t){i=t,$(function(){}.bind(this))}$=jQuery,o.prototype.save=function(t){$("#modularity-options #publishing-action .spinner").css("visibility","visible");var e=$(t).serializeObject();e.id=modularity_post_id,e.action="save_modules",$.post(ajaxurl,e,(function(t){$("#modularity-options #publishing-action .spinner").css("visibility","hidden")}))},jQuery.fn.serializeObject=function(){var t={},e=this.serializeArray();return jQuery.each(e,(function(){void 0!==t[this.name]?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(this.value||"")):t[this.name]=this.value||""})),t};let a=null;function r(t){a=t,$(function(){"undefined"!=typeof pagenow&&"admin_page_modularity-editor"==pagenow&&this.init()}.bind(this))}$=jQuery,r.prototype.init=function(){this.setupDraggable(),this.setupDroppable(),this.setupSortable()},r.prototype.setupSortable=function(){$(".modularity-js-sortable").sortable({handle:".modularity-sortable-handle",connectWith:".modularity-js-sortable",placeholder:"ui-sortable-placeholder",start:function(t,e){try{var i=jQuery(e.item).attr("data-sidebar-incompability");(i=JSON.parse(i))&&"object"==typeof i&&jQuery(".modularity-sidebar-area").each((function(t,e){i.includes(jQuery(this).attr("data-area-id"))?jQuery(this).parent().parent().addClass("modularity-incompatible-area"):jQuery(this).parent().parent().removeClass("modularity-incompatible-area")}))}catch(t){console.log("Incompability information not defined - "+t)}},stop:function(t,e){var i=e.item.parents("ul").data("area-id");e.item.find('input[name^="modularity_modules"]').each((function(t,e){var o=$(this).attr("name").replace(/\[(.*?)\]/i,"["+i+"]");$(this).attr("name",o)})),jQuery("[id^=modularity-mb-]").removeClass("modularity-incompatible-area")}}).bind(this)},r.prototype.setupDraggable=function(){$(".modularity-js-draggable").draggable({appendTo:"body",containment:"document",scroll:!1,helper:"clone",revert:"invalid",revertDuration:200,start:function(t,e){try{var i=jQuery(this).attr("data-sidebar-incompability");(i=JSON.parse(i))&&"object"==typeof i&&jQuery(".modularity-sidebar-area").each((function(t,e){i.includes(jQuery(this).attr("data-area-id"))?jQuery(this).parent().parent().addClass("modularity-incompatible-area"):jQuery(this).parent().parent().removeClass("modularity-incompatible-area")}))}catch(t){console.log("Incompability information not defined - "+t)}},stop:function(t,e){jQuery("[id^=modularity-mb-]").removeClass("modularity-incompatible-area")}})},r.prototype.setupDroppable=function(){$(".modularity-js-droppable").droppable({accept:".modularity-js-draggable",hoverClass:"modularity-state-droppable",drop:function(t,e){this.appendModule(t,e)}.bind(this)}).bind(this)},r.prototype.appendModule=function(t,e){var i=e.draggable,o=i.find(".modularity-module-name").text(),r=i.data("module-id"),n=i.attr("data-sidebar-incompability");a.Editor.Module.addModule(t.target,r,o,void 0,void 0,void 0,void 0,void 0,n)};let n=null;$=jQuery;let l=[];var s={is_thickbox:!0},d=!1;function u(t){n=t,$(function(){"undefined"!=typeof pagenow&&"admin_page_modularity-editor"==pagenow&&(this.handleEvents(),this.loadModules(modularity_post_id))}.bind(this))}u.prototype.loadModules=function(t){var e=$('[name="modularity-option-page-loading"]'),i=e.closest("form").find('[type="submit"]');i.prop("disabled",!0);var o={action:"get_post_modules",id:t};$.post(ajaxurl,o,function(t){$.each(t,function(t,e){var i=$('.modularity-sidebar-area[data-area-id="'+t+'"]');$.each(e.modules,function(t,e){"true"==e.hidden&&(e.hidden=!0);var o=void 0===e.sidebar_incompability||$.isEmptyObject(e.sidebar_incompability)?"":JSON.stringify(e.sidebar_incompability);this.addModule(i,e.post_type,e.post_type_name,e.post_title,e.ID,e.hidden,e.columnWidth,e.isDeprecated,o,e.usage??null)}.bind(this)),i.removeClass("modularity-spinner")}.bind(this)),e.remove(),i.removeAttr("disabled"),$(".modularity-sidebar-area").removeClass("modularity-spinner")}.bind(this),"json")},u.prototype.isEditingModule=function(){return d},u.prototype.getThickBoxUrl=function(t,e){var i="",o={};switch(t){case"add":i="post-new.php";break;case"edit":i="post.php"}return"number"==typeof e.postId&&(o.post=e.postId,o.action="edit"),"string"==typeof e.postType&&(o.post_type=e.postType),admin_url+i+"?"+$.param(o)+"&"+$.param(s)},u.prototype.getImportUrl=function(t){var e={};return e.post_type=t.postType,admin_url+"edit.php?"+$.param(e)+"&"+$.param(s)},u.prototype.addModule=function(t,e,i,o,a,r,l,s,d,u){o=void 0!==o?": "+o:"",a=void 0!==a?a:"",l=void 0!==l?l:"";var m=!0===s?'<span class="modularity-deprecated" style="color:#ff0000;">('+modularityAdminLanguage.deprecated+")</span>":"";d=void 0!==d?d:"";var p=this.getThickBoxUrl("add",{postType:e});n.Editor.Thickbox.postAction="add",a&&(p=this.getThickBoxUrl("edit",{postId:a}),n.Editor.Thickbox.postAction="edit");var c=this.getImportUrl({postType:e}),y="";!0===r&&(y="checked");var h=$(t).data("area-id"),b=Math.random().toString(36).substr(2,9);"number"==typeof u&&u>1&&(o+=` <em>(${u})</em>`);var f='<li id="post-'+a+'" data-module-id="'+e+'" data-module-stored-width="'+l+"\" data-sidebar-incompability='"+d+'\'>            <span class="modularity-line-wrapper">                <span class="modularity-sortable-handle">                    <i style="top:4px;" class="modularity-module-actions-symbol material-symbols material-symbols-rounded material-symbols-sharp material-symbols-outlined">drag_handle</i>                </span>                <span class="modularity-module-name">                    <strong>'+i+"</strong>                    "+m+'                    <span class="modularity-module-title">'+o+'</span>                </span>                <span class="modularity-module-actions">                    <label class="modularity-module-columns">                        <i style="top:4px;" class="modularity-cmd-visibility-on modularity-module-actions-symbol material-symbols material-symbols-rounded material-symbols-sharp material-symbols-outlined">width</i>                        <select name="modularity_modules['+h+"]["+b+'][columnWidth]">                            '+modularityAdminLanguage.widthOptions+'                        </select>                        <span class="label">'+modularityAdminLanguage.width+'</span>                    </label>                    <label class="modularity-module-hide">                        <input type="checkbox" name="modularity_modules['+h+"]["+b+'][hidden]" value="hidden" '+y+' aria-label="'+modularityAdminLanguage.langhide+'"/>                        <i style="top:4px;" class="modularity-cmd-visibility-on modularity-module-actions-symbol material-symbols material-symbols-rounded material-symbols-sharp material-symbols-outlined">visibility</i>                        <i style="top:4px;" class="modularity-cmd-visibility-off modularity-module-actions-symbol material-symbols material-symbols-rounded material-symbols-sharp material-symbols-outlined">visibility_off</i>                        <span class="label">'+modularityAdminLanguage.langvisibility+'</span>                    </label>                    <a href="'+p+'" data-modularity-modal class="modularity-js-thickbox-open modularity-err-resolver"><i style="top:3px;" class="modularity-module-actions-symbol material-symbols material-symbols-rounded material-symbols-sharp material-symbols-outlined">edit</i><span class="label">'+modularityAdminLanguage.langedit+'</span></a>                    <a href="'+c+'" class="modularity-js-thickbox-import modularity-err-resolver"><i style="top:4px;" class="modularity-module-actions-symbol material-symbols material-symbols-rounded material-symbols-sharp material-symbols-outlined">dataset_linked</i><span class="label">'+modularityAdminLanguage.langimport+'</span></a>                    <a href="#remove" class="modularity-module-remove modularity-err-resolver"><i style="top:4px;" class="modularity-module-actions-symbol material-symbols material-symbols-rounded material-symbols-sharp material-symbols-outlined">delete</i><span class="label">'+modularityAdminLanguage.langremove+'</span></a>                </span>                <input type="hidden" name="modularity_modules['+h+"]["+b+'][postid]" class="modularity-js-module-id" value="'+a+'" required>                <input type="hidden" name="modularity_modules['+h+"]["+b+'][name]" value="'+e+'" />            </span>        </li>';$(t).append(f),this.getAllCurrentModules(),$(".modularity-sidebar-area > li").each((function(t,e){$(".modularity-module-columns select",$(e)).val($(e).attr("data-module-stored-width"))})),$(".modularity-js-sortable").sortable("refresh")},u.prototype.getAllCurrentModules=function(){const t=document.querySelectorAll(".modularity-sidebar-area");let e=[];t.forEach((t=>{t.querySelectorAll("li").forEach((t=>{t.hasAttribute("id")&&e.push(t.getAttribute("id"))}))})),l=e},u.prototype.updateModule=function(t,e){t.find("a.modularity-js-thickbox-open").attr("href",this.getThickBoxUrl("edit",{postId:e.post_id})),t.find("input.modularity-js-module-id").val(e.post_id).change(),t.find(".modularity-module-title").text(": "+e.title)},u.prototype.removeModule=function(t){confirm(modularityAdminLanguage.actionRemove)&&t.remove()},u.prototype.arraysAreEqual=function(t=[],e=[]){if(t.length!==e.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0},u.prototype.handleEvents=function(){let t=!1;const e=document.getElementById("publish");e&&e.addEventListener("click",(()=>{t=!0})),window.addEventListener("beforeunload",(e=>{const i=document.querySelectorAll(".modularity-sidebar-area > li");let o=[];i.forEach((t=>{t.hasAttribute("id")&&o.push(t.getAttribute("id"))})),t||this.arraysAreEqual(o,l)||(e.returnValue="")})),$(document).on("click",".modularity-module-remove",function(t){t.preventDefault();var e=$(t.target).closest("li");this.removeModule(e)}.bind(this)),$(document).on("click",".modularity-js-thickbox-import",(function(t){t.preventDefault(),$(t.target).closest("a"),d=$(t.target).closest("li"),n.Editor.Thickbox.postAction="import",n.Prompt.Modal.open($(t.target).closest("a").attr("href"))})),$(document).on("click",".modularity-js-thickbox-open",function(t){t.preventDefault(),$(t.target).closest("a").attr("href").indexOf("post.php")>-1&&(n.Editor.Thickbox.postAction="edit"),d=$(t.target).closest("li"),n.Prompt.Modal.open($(t.target).closest("a").attr("href"))}.bind(this))};let m=null;function p(t){m=t}$=jQuery,p.prototype.modulePostCreated=function(t){m.Prompt.Modal.close();var e=parent.Modularity.Editor.Module.isEditingModule(),i={action:"get_post",id:t};$.post(ajaxurl,i,(function(t){var i={post_id:t.ID,title:t.post_title};m.Editor.Module.updateModule(e,i),m.Editor.Autosave.save("form")}),"json")};let c=null;$=jQuery;var y=!1,h="validation-error";function b(t){c=t,this.handleEvents()}b.prototype.run=function(){y=!1,this.checkRequired()},b.prototype.checkRequired=function(){var t=$("[required]");t.removeClass(h),t.each(function(t,e){0===$(e).val().length&&($(e).parents("li").addClass(h),$(e).one("change",(function(t){$(t.target).parents("li").removeClass(h)})),y=!0)}.bind(this))},b.prototype.handleEvents=function(){$(document).on("click","#modularity-mb-editor-publish #publish",function(t){return this.run(),!y||($("#modularity-mb-editor-publish .spinner").css("visibility","hidden"),!1)}.bind(this))};let f=null;function v(t){f=t,$(function(){}.bind(this))}$=jQuery,v.prototype.uuid=function(t){return Math.random().toString(36).substr(2,9)};var g=!1;let w=null;function j(t){$(function(){w=t,$(document).on("click",".modularity-js-thickbox-widget-import-widget",(function(e){e.preventDefault(),g=$(e.target).parents(".widget-inside");var i=t.Editor.Module.getImportUrl({postType:$(e.target).parents(".widget-inside").find(".modularity-widget-module-type select").val()});t.Editor.Module.editingModule=$(e.target).closest(".widget-inside"),t.Editor.Thickbox.postAction="import-widget",t.Prompt.Modal.open(i)})),$(document).on("click",".modularity-js-thickbox-open-widget",function(e){e.preventDefault(),$(e.target).closest("a").attr("href").indexOf("post.php")>-1&&(t.Editor.Thickbox.postAction="edit"),editingModule=$(e.target).closest("li"),t.Prompt.Modal.open($(e.target).closest("a").attr("href"))}.bind(this))}.bind(this))}$=jQuery,j.prototype.isEditingWidget=function(){return g},j.prototype.updateWidget=function(t,e){$(t).find(".modularity-widget-module-id-span").html(e.post_id),$(t).find(".modularity-widget-module-id").val(e.post_id),$(t).find(".modularity-widget-module-edit").attr("href","post.php?post="+e.post_id+"&action=edit&is_thickbox=true").removeClass("hidden"),$(t).find(".modularity-widget-module-title-span").html(e.title),$(t).find(".modularity-widget-module-title").val(e.title)};var E,x,A,M=function i(o){var a=e[o];if(void 0!==a)return a.exports;var r=e[o]={exports:{}};return t[o](r,r.exports,i),r.exports}(4590);function k(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}class _{constructor(t,e,i){k(this,"fetcher",{}),k(this,"endpoints",{}),k(this,"nonce",""),k(this,"cacheBustKey",0),this.fetcher=t,this.endpoints=e,this.nonce=i,this.cacheBustKey=Math.floor(Date.now()/15e3)}async getModule(t){const e=`${this.endpoints.getModule}/${t}?cacheBust=${this.cacheBustKey}`,i=await this.fetcher(e);if(!i.ok)throw new Error(`Could not load module from URL: ${e}`);const o=await i.json(),a=document.createElement("template");return a.innerHTML=o,a.content.firstChild}}class C{constructor(t,e,i){this.id=t,this.element=e,this.restAPI=i,this.setupEventListeners()}setupEventListeners(){if(!this.element)throw new Error("Element is not set.");this.element.addEventListener("refresh",this.handleRefresh.bind(this)),this.element.addEventListener("DOMNodeRemoved",(()=>{this.element.removeEventListener("refresh",this.handleRefresh)}))}refresh(t=null){const e=new CustomEvent("refresh");this.element.dispatchEvent(e),t&&setTimeout((()=>{this.refresh(t)}),t)}async handleRefresh(){const t=await this.restAPI.getModule(this.id);this.replace(t)}replace(t){this.element.parentNode.replaceChild(t,this.element),this.element=t,this.setupEventListeners()}getRefreshInterval(){const t=this.element.getAttribute("data-module-refresh-interval");return!t||isNaN(t)?null:1e3*parseInt(t)}}E=C,A="[data-module-refresh-interval]",(x=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(x="selector"))in E?Object.defineProperty(E,x,{value:A,enumerable:!0,configurable:!0,writable:!0}):E[x]=A;class T{constructor(t){this.restAPI=t}refreshModules(){const t=document.querySelectorAll(C.selector),e=Array.from(t).map((t=>new C(t.getAttribute("data-module-id"),t,this.restAPI)));for(const t of e){const e=t.getRefreshInterval();t.refresh(e)}}}if(!parent.Modularity){var L=parent.Modularity||{};L.Editor=L.Editor||{},L.Editor.Autosave=new o(L),L.Editor.DragAndDrop=new r(L),L.Editor.Module=new u(L),L.Editor.Thickbox=new p(L),L.Editor.Validate=new b(L),L.Helpers=L.Helpers||{},L.Helpers.Helpers=new v(L),L.Helpers.Widget=new j(L),L.Prompt=L.Prompt||{},L.Prompt.Modal=new M.A(L),parent.Modularity=L,function(t){t('input[type="checkbox"].sidebar-area-activator').on("click",(function(e){var i=t(this).is(":checked"),o=t(this).attr("value");e.shiftKey&&(i?t('input.sidebar-area-activator[type="checkbox"][value="'+o+'"]').attr("checked",!0):t('input.sidebar-area-activator[type="checkbox"][value="'+o+'"]').attr("checked",!1))}))}(jQuery),function(t){t("#modularity-options #publish").on("click",(function(){t(this).siblings(".spinner").css("visibility","visible")})),t('a.wp-first-item[href="admin.php?page=modularity"]').parent("li").remove(),t("#modularity-tabs a").on("click",(function(e){return wp.autosave&&(t(window).unbind(),wp.autosave.server.triggerSave(),t(document).ajaxComplete((function(){return!0}))),!0}))}(jQuery),jQuery(document).ready((function(t){if(t("#modularity-mb-modules").length){var e=t("#modularity-mb-modules").offset();t(document).scroll((function(){t(window).scrollTop()+50>e.top&&!t("#modularity-mb-modules").hasClass("is-fixed")?t("#modularity-mb-modules").addClass("is-fixed"):t(window).scrollTop()+50<e.top&&t("#modularity-mb-modules").hasClass("is-fixed")&&t("#modularity-mb-modules").removeClass("is-fixed")}))}t(".modularity-edit-module a").on("click",(function(e){e.preventDefault(),L.Editor.Thickbox.postAction="edit-inline-not-saved",L.Prompt.Modal.open(t(e.target).closest("a").attr("href"))}))}))}!function(){try{!function(){const{wpApiSettings:t}=window;if(!t?.root)throw new Error("wpApiSettings or wpApiSettings.root is not present on the window object.")}();const{root:t,nonce:e}=window.wpApiSettings,i=window.fetch.bind(window),o=new _(i,{getModule:`${t}modularity/v1/modules`},e);new T(o).refreshModules()}catch(t){console.warn(t)}}()})();
//# sourceMappingURL=modularity.7cb6eb8ea0c534ffb0b9.js.map
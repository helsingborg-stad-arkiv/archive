(()=>{"use strict";(()=>{class e{constructor(e,t,i,s,n,a,r,o){var l,u;Object.defineProperty(this,"submitButton",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"closeButton",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"errorNotice",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"itemsObject",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"checkboxes",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"userId",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"moduleId",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"metaKey",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"savingLang",{enumerable:!0,configurable:!0,writable:!0,value:"Saving"}),Object.defineProperty(this,"buttonText",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.buttonText=null!==(l=this.submitButton.textContent)&&void 0!==l?l:"Save",this.savingLang=null!==(u=this.submitButton.getAttribute("data-js-saving-lang"))&&void 0!==u?u:this.savingLang,wpApiSettings&&this.submitListener()}submitListener(){this.submitButton.addEventListener("click",(e=>{e.preventDefault();let t={};this.checkboxes.forEach((e=>{t[e.value]=e.checked})),this.patchUser(t)}))}patchUser(e){var t;this.handleBeforeSave();const i=`${null===wpApiSettings||void 0===wpApiSettings?void 0:wpApiSettings.root}wp/v2/users/${this.userId}`;fetch(i,{method:"GET",headers:{"Content-Type":"application/json","X-WP-NONCE":null!==(t=null===wpApiSettings||void 0===wpApiSettings?void 0:wpApiSettings.nonce)&&void 0!==t?t:""}}).then((e=>{if(!e.ok)throw new Error("Failed to fetch existing user data");return e.json()})).then((t=>{var s;let n=t.meta?t.meta[this.metaKey]:null;return n&&"object"==typeof n&&!Array.isArray(n)||(n={}),n[this.moduleId]=e,fetch(i,{method:"PATCH",headers:{"Content-Type":"application/json","X-WP-NONCE":null!==(s=null===wpApiSettings||void 0===wpApiSettings?void 0:wpApiSettings.nonce)&&void 0!==s?s:""},body:JSON.stringify({meta:{[this.metaKey]:n}})})})).then((()=>{this.handleSuccessfullSave(e)})).catch((e=>{console.error("Error:",e),this.handleFailedSave()}))}handleBeforeSave(){this.submitButton.disabled=!0,this.closeButton.disabled=!0,this.submitButton.textContent=this.savingLang}handleFailedSave(){this.errorNotice.classList.remove("u-display--none"),this.submitButton.disabled=!1,this.closeButton.disabled=!1,this.submitButton.textContent=this.buttonText}handleSuccessfullSave(e){this.submitButton.disabled=!1,this.closeButton.disabled=!1,this.submitButton.textContent=this.buttonText,this.showOrHideItemsBasedOnSaved(e),this.closeButton.click()}showOrHideItemsBasedOnSaved(e){for(const[t,i]of Object.entries(this.itemsObject))t in e&&(e[t]?i.classList.remove("u-display--none"):i.classList.add("u-display--none"))}}document.addEventListener("DOMContentLoaded",(function(){document.querySelectorAll("[data-js-user-editable]").forEach((t=>{!function(t){const i=t.getAttribute("data-js-user-editable");if(!i)return;const s=t.getAttribute("data-js-user-editable-user"),n=t.getAttribute("data-js-user-editable-id"),a=t.querySelector('button[type="submit"]'),r=t.querySelectorAll('input[type="checkbox"]'),o=t.querySelector("[data-js-user-editable-error]");let l={};t.querySelectorAll("[data-js-item-id]").forEach((e=>{const t=e.getAttribute("data-js-item-id");t&&(l[t]=e)}));const u=t.querySelector("button[data-js-cancel-save]");a&&u&&s&&n&&r.length&&new e(a,u,o,l,r,s,n,i)}(t)}))}))})()})();
//# sourceMappingURL=user-editable-list.68e1fed3840da425e37e.js.map
{"version":3,"file":"app.BIcG0UqO.js","sources":["../../../../source/ts/ManifestLoader.ts","../../../../source/ts/UrlUpdater.ts","../../../../source/ts/ArchiveController.ts","../../../../source/ts/app.ts"],"sourcesContent":["export class ManifestLoader {\n  async load(): Promise<Record<string, string[]>> {\n    const res = await fetch('./index.json');\n    if (!res.ok) {\n      throw new Error('Manifest not found');\n    }\n    return await res.json();\n  }\n}","export class UrlUpdater {\n  /**\n   * Formats the query string with URL encoding.\n   * Example: ?domain={encodedDomain}&url={encodedUrl}&date={encodedDate}\n   */\n  private formatHash(domain: string, url: string, date: string): string {\n    const enc = encodeURIComponent;\n    return `?domain=${enc(domain)}&url=${enc(url)}&date=${enc(date)}`;\n  }\n\n  /**\n   * Parses the query string format and returns the decoded values.\n   * Returns null if parsing fails or required fields are missing.\n   */\n  static parseHash(hash: string): { domain: string; url: string; date: string } | null {\n    if (!hash.startsWith('?')) return null;\n    // Remove \"?\"\n    const query = hash.slice(1);\n    const params = new URLSearchParams(query);\n    const domain = params.get('domain');\n    const url = params.get('url');\n    const date = params.get('date');\n    if (domain && url && date) {\n      return {\n        domain: decodeURIComponent(domain),\n        url: decodeURIComponent(url),\n        date: decodeURIComponent(date),\n      };\n    }\n    return null;\n  }\n\n  private normalizeUrl(src: string, domain: string, date: string): string {\n    if (!domain || !date) return '';\n    const prefix = `/${domain}/${date}/${domain}/`;\n\n    if (src.includes(prefix)) {\n      src = src.slice(src.indexOf(prefix) + prefix.length - 1);\n    }\n\n    if (!src.startsWith('/')) src = '/' + src;\n    if (src.endsWith('/index.html')) src = src.slice(0, -10);\n    if (src.endsWith('/') && src.length > 1) src = src.slice(0, -1);\n\n    return src;\n  }\n\n  update(src: string, domain: string, date: string): string {\n    const normalizedSrc = this.normalizeUrl(src, domain, date);\n    this.apply(domain, normalizedSrc, date);\n    return normalizedSrc;\n  }\n\n  apply(domain: string, src: string, date: string): void {\n    const newQuery = this.formatHash(domain, src, date);\n    const newUrl = `${window.location.pathname}${newQuery}`;\n    window.history.replaceState(null, '', newUrl);\n  }\n}","import { ManifestLoader } from './ManifestLoader';\nimport { UrlUpdater } from './UrlUpdater';\n\nexport class ArchiveController {\n  private manifest: Record<string, string[]> = {};\n  private domainSelect: HTMLSelectElement;\n  private dateSelect: HTMLSelectElement;\n  private preview: HTMLIFrameElement;\n  private urlDiv: HTMLElement;\n  private urlUpdater = new UrlUpdater();\n  private loader = new ManifestLoader();\n\n  constructor() {\n    this.domainSelect = document.getElementById('domain') as HTMLSelectElement;\n    this.dateSelect = document.getElementById('date') as HTMLSelectElement;\n    this.preview = document.getElementById('preview') as HTMLIFrameElement;\n    this.urlDiv = document.getElementById('url') as HTMLElement;\n  }\n\n  async init() {\n    try {\n      this.manifest = await this.loader.load();\n      this.populateDomains();\n      this.restoreSelection();\n      this.addListeners();\n    } catch (err: any) {\n      const errorDiv = document.getElementById('manifest-error')!;\n      errorDiv.style.display = 'flex';\n    }\n  }\n\n  private populateDomains() {\n    const domains = Object.keys(this.manifest).sort();\n    this.domainSelect.innerHTML =\n      '<option value=\"\">-- Select site --</option>' +\n      domains.map(d => `<option value=\"${d}\">${d}</option>`).join('');\n  }\n\n  private addListeners() {\n    this.domainSelect.addEventListener('change', () => this.onDomainChange());\n    this.dateSelect.addEventListener('change', () => this.loadArchive());\n    this.preview.addEventListener('load', () => this.onIframeLoad());\n    setInterval(() => this.syncUrl(), 500);\n  }\n\n  private onDomainChange() {\n    const domain = this.domainSelect.value;\n    const dates = this.manifest[domain] || [];\n    this.dateSelect.innerHTML = dates.map(d => `<option value=\"${d}\">${d}</option>`).join('');\n    if (dates.length) this.dateSelect.value = dates[dates.length - 1];\n    this.loadArchive();\n  }\n\n  private loadArchive() {\n    const domain = this.domainSelect.value;\n    const date = this.dateSelect.value;\n    if (!domain || !date) {\n      this.preview.src = '';\n      this.urlDiv.textContent = '';\n      return;\n    }\n    const src = `./${domain}/${date}/${domain}/index.html`;\n    this.preview.src = src;\n    localStorage.setItem('lastDomain', domain);\n    localStorage.setItem('lastDate', date);\n    this.urlDiv.textContent = this.urlUpdater.update(src, domain, date);\n  }\n\n  private onIframeLoad() {\n    this.preventExternalTargets();\n    try {\n      const iframeWindow = this.preview.contentWindow!;\n      const path = iframeWindow.location.pathname;\n      this.urlDiv.textContent = this.urlUpdater.update(path, this.domainSelect.value, this.dateSelect.value);\n    } catch {\n      throw new Error('Could not access iframe content');\n    }\n  }\n\n  private preventExternalTargets() {\n    try {\n      const doc = this.preview.contentDocument || this.preview.contentWindow?.document;\n      if (!doc) return;\n      const links = doc.querySelectorAll('a[target=\"_blank\"], a[target=\"_top\"], a[target=\"_parent\"]');\n      links.forEach(link => link.removeAttribute('target'));\n    } catch {}\n  }\n\n  private restoreSelection() {\n    const lastDomain = localStorage.getItem('lastDomain');\n    const lastDate = localStorage.getItem('lastDate');\n    if (lastDomain && this.manifest[lastDomain]) {\n      this.domainSelect.value = lastDomain;\n      const dates = this.manifest[lastDomain];\n      this.dateSelect.innerHTML = dates.map(d => `<option value=\"${d}\">${d}</option>`).join('');\n      if (lastDate && dates.includes(lastDate)) this.dateSelect.value = lastDate;\n      this.loadArchive();\n    }\n  }\n\n  private syncUrl() {\n    try {\n      const iframeWindow = this.preview.contentWindow!;\n      const path = iframeWindow.location.pathname;\n      const domain = this.domainSelect.value;\n      const date = this.dateSelect.value;\n      if (!domain || !date) return;\n      this.urlDiv.textContent = this.urlUpdater.update(path, domain, date);\n    } catch {}\n  }\n}","import { ArchiveController } from './ArchiveController';\nconst controller = new ArchiveController();\ncontroller.init();"],"names":[],"mappings":"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"}
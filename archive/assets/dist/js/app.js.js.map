{"version":3,"file":"app.js.js","sources":["../../../../source/ts/app.ts"],"sourcesContent":["async function loadManifest() {\n      const res = await fetch('./index.json');\n      if (!res.ok) throw new Error('Manifest not found');\n      return await res.json();\n    }\n\n    async function init() {\n      const manifest = await loadManifest();\n      const domainSelect = document.getElementById('domain');\n      const dateSelect = document.getElementById('date');\n      const preview = document.getElementById('preview');\n      const urlDiv = document.getElementById('url');\n\n      const domains = Object.keys(manifest).sort();\n      domainSelect.innerHTML = '<option value=\"\">-- Select site --</option>' + \n        domains.map(d => `<option value=\"${d}\">${d}</option>`).join('');\n\n      function updateUrlDisplay(src, domain, date) {\n        let prefix = `/${domain}/${date}/${domain}/`;\n        console.log(src.indexOf(prefix));\n\n        if (src.indexOf(prefix) !== -1) {\n          src = src.slice(src.indexOf(prefix) + prefix.length - 1);\n        }\n        if (!src.startsWith('/')) src = '/' + src;\n\n        //Remove index.html from the end\n        if (src.endsWith('/index.html')) {\n          src = src.slice(0, -10);\n        }\n        //Remove trailing slash if not root\n        if (src.endsWith('/') && src.length > 1) {\n          src = src.slice(0, -1);\n        }\n\n        urlDiv.textContent = src;\n      }\n\n      domainSelect.addEventListener('change', () => {\n        const domain = domainSelect.value;\n        const dates = manifest[domain] || [];\n        dateSelect.innerHTML = dates.map(d => `<option value=\"${d}\">${d}</option>`).join('');\n        if (dates.length) dateSelect.value = dates[dates.length - 1];\n        loadArchive();\n      });\n\n      dateSelect.addEventListener('change', loadArchive);\n\n      function loadArchive() {\n        const domain = domainSelect.value;\n        const date = dateSelect.value;\n        if (!domain || !date) {\n          preview.src = '';\n          urlDiv.textContent = '';\n          return;\n        }\n        const baseSrc = `./${domain}/${date}/${domain}/index.html`;\n        preview.src = baseSrc;\n        localStorage.setItem('lastDomain', domain);\n        localStorage.setItem('lastDate', date);\n        updateUrlDisplay(baseSrc, domain, date);\n      }\n\n      // Restore previous selection\n      const lastDomain = localStorage.getItem('lastDomain');\n      const lastDate = localStorage.getItem('lastDate');\n      if (lastDomain && manifest[lastDomain]) {\n        domainSelect.value = lastDomain;\n        const dates = manifest[lastDomain];\n        dateSelect.innerHTML = dates.map(d => `<option value=\"${d}\">${d}</option>`).join('');\n        if (lastDate && dates.includes(lastDate)) dateSelect.value = lastDate;\n        loadArchive();\n      }\n\n      function preventExternalTargets(iframe) {\n        try {\n          const doc = iframe.contentDocument || iframe.contentWindow.document;\n          if (!doc) return;\n          const links = doc.querySelectorAll('a[target=\"_blank\"], a[target=\"_top\"], a[target=\"_parent\"]');\n          links.forEach(link => {\n            link.removeAttribute('target');\n          });\n        } catch(e) {\n          // Cross-origin, ignore\n        }\n      }\n\n      preview.addEventListener('load', () => {\n        preventExternalTargets(preview);\n\n        try {\n          const iframeWindow = preview.contentWindow;\n          const iframeLocation = iframeWindow.location;\n          const domain = domainSelect.value;\n          const date = dateSelect.value;\n\n          updateUrlDisplay(baseSrc, domain, date);\n\n          // Attach click listener to links to update url display on navigation inside iframe\n          const doc = iframeWindow.document;\n          if (doc) {\n            doc.body.addEventListener('click', function(event) {\n              const target = event.target.closest('a');\n              if (!target) return;\n              const href = target.getAttribute('href');\n              if (!href || href.startsWith('http') || href.startsWith('mailto:') || href.startsWith('javascript:')) return;\n              event.preventDefault();\n              let newUrl;\n              if (href.startsWith('/')) {\n                // Absolute path inside iframe origin\n                newUrl = new URL(href, iframeLocation.origin).href;\n              } else {\n                // Relative path\n                newUrl = new URL(href, iframeLocation.href).href;\n              }\n              iframeWindow.location.href = newUrl;\n            }, true);\n          }\n        } catch(e) {\n          // Cross-origin, ignore\n        }\n      });\n\n      // Periodically update url display in case navigation happens programmatically\n      setInterval(() => {\n        try {\n          const iframeWindow = preview.contentWindow;\n          const iframeLocation = iframeWindow.location;\n          const domain = domainSelect.value;\n          const date = dateSelect.value;\n          if (!domain || !date) return;\n          updateUrlDisplay(iframeLocation.pathname, domain, date);\n\n        } catch(e) {\n          // Cross-origin, ignore\n        }\n      }, 500);\n    }\n\n    init().catch(err => {\n      document.body.innerHTML = '<div id=\"manifest-error\">Could not load site index. Reason: ' + err.message + '</div>';\n    });"],"names":["baseSrc"],"mappings":"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"}
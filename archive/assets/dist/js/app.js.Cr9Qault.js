var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});async function loadManifest(){const res=await fetch("./index.json");if(!res.ok)throw new Error("Manifest not found");return await res.json()}__name(loadManifest,"loadManifest");async function init(){const manifest=await loadManifest(),domainSelect=document.getElementById("domain"),dateSelect=document.getElementById("date"),preview=document.getElementById("preview"),urlDiv=document.getElementById("url"),domains=Object.keys(manifest).sort();domainSelect.innerHTML='<option value="">-- Select site --</option>'+domains.map(d=>`<option value="${d}">${d}</option>`).join("");function updateUrlDisplay(src,domain,date){let prefix=`/${domain}/${date}/${domain}/`;console.log(src.indexOf(prefix)),src.indexOf(prefix)!==-1&&(src=src.slice(src.indexOf(prefix)+prefix.length-1)),src.startsWith("/")||(src="/"+src),src.endsWith("/index.html")&&(src=src.slice(0,-10)),src.endsWith("/")&&src.length>1&&(src=src.slice(0,-1)),urlDiv.textContent=src}__name(updateUrlDisplay,"updateUrlDisplay"),domainSelect.addEventListener("change",()=>{const domain=domainSelect.value,dates=manifest[domain]||[];dateSelect.innerHTML=dates.map(d=>`<option value="${d}">${d}</option>`).join(""),dates.length&&(dateSelect.value=dates[dates.length-1]),loadArchive()}),dateSelect.addEventListener("change",loadArchive);function loadArchive(){const domain=domainSelect.value,date=dateSelect.value;if(!domain||!date){preview.src="",urlDiv.textContent="";return}const baseSrc2=`./${domain}/${date}/${domain}/index.html`;preview.src=baseSrc2,localStorage.setItem("lastDomain",domain),localStorage.setItem("lastDate",date),updateUrlDisplay(baseSrc2,domain,date)}__name(loadArchive,"loadArchive");const lastDomain=localStorage.getItem("lastDomain"),lastDate=localStorage.getItem("lastDate");if(lastDomain&&manifest[lastDomain]){domainSelect.value=lastDomain;const dates=manifest[lastDomain];dateSelect.innerHTML=dates.map(d=>`<option value="${d}">${d}</option>`).join(""),lastDate&&dates.includes(lastDate)&&(dateSelect.value=lastDate),loadArchive()}function preventExternalTargets(iframe){try{const doc=iframe.contentDocument||iframe.contentWindow.document;if(!doc)return;doc.querySelectorAll('a[target="_blank"], a[target="_top"], a[target="_parent"]').forEach(link=>{link.removeAttribute("target")})}catch{}}__name(preventExternalTargets,"preventExternalTargets"),preview.addEventListener("load",()=>{preventExternalTargets(preview);try{const iframeWindow=preview.contentWindow,iframeLocation=iframeWindow.location,domain=domainSelect.value,date=dateSelect.value;updateUrlDisplay(baseSrc,domain,date);const doc=iframeWindow.document;doc&&doc.body.addEventListener("click",function(event){const target=event.target.closest("a");if(!target)return;const href=target.getAttribute("href");if(!href||href.startsWith("http")||href.startsWith("mailto:")||href.startsWith("javascript:"))return;event.preventDefault();let newUrl;href.startsWith("/")?newUrl=new URL(href,iframeLocation.origin).href:newUrl=new URL(href,iframeLocation.href).href,iframeWindow.location.href=newUrl},!0)}catch{}}),setInterval(()=>{try{const iframeLocation=preview.contentWindow.location,domain=domainSelect.value,date=dateSelect.value;if(!domain||!date)return;updateUrlDisplay(iframeLocation.pathname,domain,date)}catch{}},500)}__name(init,"init");init().catch(err=>{document.body.innerHTML='<div id="manifest-error">Could not load site index. Reason: '+err.message+"</div>"});
//# sourceMappingURL=app.js.Cr9Qault.js.map

{"version":3,"file":"app.js.Cr9Qault.js","sources":["../../../../source/ts/app.ts"],"sourcesContent":["async function loadManifest() {\n      const res = await fetch('./index.json');\n      if (!res.ok) throw new Error('Manifest not found');\n      return await res.json();\n    }\n\n    async function init() {\n      const manifest = await loadManifest();\n      const domainSelect = document.getElementById('domain');\n      const dateSelect = document.getElementById('date');\n      const preview = document.getElementById('preview');\n      const urlDiv = document.getElementById('url');\n\n      const domains = Object.keys(manifest).sort();\n      domainSelect.innerHTML = '<option value=\"\">-- Select site --</option>' + \n        domains.map(d => `<option value=\"${d}\">${d}</option>`).join('');\n\n      function updateUrlDisplay(src, domain, date) {\n        let prefix = `/${domain}/${date}/${domain}/`;\n        console.log(src.indexOf(prefix));\n\n        if (src.indexOf(prefix) !== -1) {\n          src = src.slice(src.indexOf(prefix) + prefix.length - 1);\n        }\n        if (!src.startsWith('/')) src = '/' + src;\n\n        //Remove index.html from the end\n        if (src.endsWith('/index.html')) {\n          src = src.slice(0, -10);\n        }\n        //Remove trailing slash if not root\n        if (src.endsWith('/') && src.length > 1) {\n          src = src.slice(0, -1);\n        }\n\n        urlDiv.textContent = src;\n      }\n\n      domainSelect.addEventListener('change', () => {\n        const domain = domainSelect.value;\n        const dates = manifest[domain] || [];\n        dateSelect.innerHTML = dates.map(d => `<option value=\"${d}\">${d}</option>`).join('');\n        if (dates.length) dateSelect.value = dates[dates.length - 1];\n        loadArchive();\n      });\n\n      dateSelect.addEventListener('change', loadArchive);\n\n      function loadArchive() {\n        const domain = domainSelect.value;\n        const date = dateSelect.value;\n        if (!domain || !date) {\n          preview.src = '';\n          urlDiv.textContent = '';\n          return;\n        }\n        const baseSrc = `./${domain}/${date}/${domain}/index.html`;\n        preview.src = baseSrc;\n        localStorage.setItem('lastDomain', domain);\n        localStorage.setItem('lastDate', date);\n        updateUrlDisplay(baseSrc, domain, date);\n      }\n\n      // Restore previous selection\n      const lastDomain = localStorage.getItem('lastDomain');\n      const lastDate = localStorage.getItem('lastDate');\n      if (lastDomain && manifest[lastDomain]) {\n        domainSelect.value = lastDomain;\n        const dates = manifest[lastDomain];\n        dateSelect.innerHTML = dates.map(d => `<option value=\"${d}\">${d}</option>`).join('');\n        if (lastDate && dates.includes(lastDate)) dateSelect.value = lastDate;\n        loadArchive();\n      }\n\n      function preventExternalTargets(iframe) {\n        try {\n          const doc = iframe.contentDocument || iframe.contentWindow.document;\n          if (!doc) return;\n          const links = doc.querySelectorAll('a[target=\"_blank\"], a[target=\"_top\"], a[target=\"_parent\"]');\n          links.forEach(link => {\n            link.removeAttribute('target');\n          });\n        } catch(e) {\n          // Cross-origin, ignore\n        }\n      }\n\n      preview.addEventListener('load', () => {\n        preventExternalTargets(preview);\n\n        try {\n          const iframeWindow = preview.contentWindow;\n          const iframeLocation = iframeWindow.location;\n          const domain = domainSelect.value;\n          const date = dateSelect.value;\n\n          updateUrlDisplay(baseSrc, domain, date);\n\n          // Attach click listener to links to update url display on navigation inside iframe\n          const doc = iframeWindow.document;\n          if (doc) {\n            doc.body.addEventListener('click', function(event) {\n              const target = event.target.closest('a');\n              if (!target) return;\n              const href = target.getAttribute('href');\n              if (!href || href.startsWith('http') || href.startsWith('mailto:') || href.startsWith('javascript:')) return;\n              event.preventDefault();\n              let newUrl;\n              if (href.startsWith('/')) {\n                // Absolute path inside iframe origin\n                newUrl = new URL(href, iframeLocation.origin).href;\n              } else {\n                // Relative path\n                newUrl = new URL(href, iframeLocation.href).href;\n              }\n              iframeWindow.location.href = newUrl;\n            }, true);\n          }\n        } catch(e) {\n          // Cross-origin, ignore\n        }\n      });\n\n      // Periodically update url display in case navigation happens programmatically\n      setInterval(() => {\n        try {\n          const iframeWindow = preview.contentWindow;\n          const iframeLocation = iframeWindow.location;\n          const domain = domainSelect.value;\n          const date = dateSelect.value;\n          if (!domain || !date) return;\n          updateUrlDisplay(iframeLocation.pathname, domain, date);\n\n        } catch(e) {\n          // Cross-origin, ignore\n        }\n      }, 500);\n    }\n\n    init().catch(err => {\n      document.body.innerHTML = '<div id=\"manifest-error\">Could not load site index. Reason: ' + err.message + '</div>';\n    });"],"names":["baseSrc"],"mappings":"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"}
var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,"name",{value,configurable:!0});const _ManifestLoader=class _ManifestLoader{async load(){const res=await fetch("./index.json");if(!res.ok)throw new Error("Manifest not found");return await res.json()}};__name(_ManifestLoader,"ManifestLoader");let ManifestLoader=_ManifestLoader;const _UrlUpdater=class _UrlUpdater{formatHash(domain,url,date){const enc=encodeURIComponent;return`?domain=${enc(domain)}&url=${enc(url)}&date=${enc(date)}`}static parseHash(hash){if(!hash.startsWith("?"))return null;const query=hash.slice(1),params=new URLSearchParams(query),domain=params.get("domain"),url=params.get("url"),date=params.get("date");return domain&&url&&date?{domain:decodeURIComponent(domain),url:decodeURIComponent(url),date:decodeURIComponent(date)}:null}normalizeUrl(src,domain,date){if(!domain||!date)return"";const prefix=`/${domain}/${date}/${domain}/`;return src.includes(prefix)&&(src=src.slice(src.indexOf(prefix)+prefix.length-1)),src.startsWith("/")||(src="/"+src),src.endsWith("/index.html")&&(src=src.slice(0,-10)),src.endsWith("/")&&src.length>1&&(src=src.slice(0,-1)),src}update(src,domain,date){const normalizedSrc=this.normalizeUrl(src,domain,date);return this.apply(domain,normalizedSrc,date),normalizedSrc}apply(domain,src,date){const newQuery=this.formatHash(domain,src,date),newUrl=`${window.location.pathname}${newQuery}`;window.history.replaceState(null,"",newUrl)}};__name(_UrlUpdater,"UrlUpdater");let UrlUpdater=_UrlUpdater;const _ArchiveController=class _ArchiveController{constructor(){this.manifest={},this.urlUpdater=new UrlUpdater,this.loader=new ManifestLoader,this.domainSelect=document.getElementById("domain"),this.dateSelect=document.getElementById("date"),this.preview=document.getElementById("preview"),this.urlDiv=document.getElementById("url")}async init(){try{this.manifest=await this.loader.load(),this.populateDomains(),this.restoreSelection(),this.addListeners()}catch{const errorDiv=document.getElementById("manifest-error");errorDiv.style.display="flex"}}populateDomains(){const domains=Object.keys(this.manifest).sort();this.domainSelect.innerHTML='<option value="">-- Select site --</option>'+domains.map(d=>`<option value="${d}">${d}</option>`).join("")}addListeners(){this.domainSelect.addEventListener("change",()=>this.onDomainChange()),this.dateSelect.addEventListener("change",()=>this.loadArchive()),this.preview.addEventListener("load",()=>this.onIframeLoad()),setInterval(()=>this.syncUrl(),500)}onDomainChange(){const domain=this.domainSelect.value,dates=this.manifest[domain]||[];this.dateSelect.innerHTML=dates.map(d=>`<option value="${d}">${d}</option>`).join(""),dates.length&&(this.dateSelect.value=dates[dates.length-1]),this.loadArchive()}loadArchive(){const domain=this.domainSelect.value,date=this.dateSelect.value;if(!domain||!date){this.preview.src="",this.urlDiv.textContent="";return}const src=`./${domain}/${date}/${domain}/index.html`;this.preview.src=src,localStorage.setItem("lastDomain",domain),localStorage.setItem("lastDate",date),this.urlDiv.textContent=this.urlUpdater.update(src,domain,date)}onIframeLoad(){this.preventExternalTargets();try{const path=this.preview.contentWindow.location.pathname;this.urlDiv.textContent=this.urlUpdater.update(path,this.domainSelect.value,this.dateSelect.value)}catch{throw new Error("Could not access iframe content")}}preventExternalTargets(){try{const doc=this.preview.contentDocument||this.preview.contentWindow?.document;if(!doc)return;if(!doc.getElementById("unavailable-link-style")){const style=doc.createElement("style");style.id="unavailable-link-style",style.textContent=`
          .unavailable-link {
            opacity: 0.5;
            pointer-events: none;
            text-decoration: line-through;
          }
        `,doc.head.appendChild(style)}doc.querySelectorAll('a[target="_blank"], a[target="_top"], a[target="_parent"], a').forEach(link=>{link.removeAttribute("target");const href=link.getAttribute("href");href&&/^https?:\/\//i.test(href)&&(link.classList.add("unavailable-link"),link.style.pointerEvents="none")})}catch{}}restoreSelection(){const lastDomain=localStorage.getItem("lastDomain"),lastDate=localStorage.getItem("lastDate");if(lastDomain&&this.manifest[lastDomain]){this.domainSelect.value=lastDomain;const dates=this.manifest[lastDomain];this.dateSelect.innerHTML=dates.map(d=>`<option value="${d}">${d}</option>`).join(""),lastDate&&dates.includes(lastDate)&&(this.dateSelect.value=lastDate),this.loadArchive()}}syncUrl(){try{const path=this.preview.contentWindow.location.pathname,domain=this.domainSelect.value,date=this.dateSelect.value;if(!domain||!date)return;this.urlDiv.textContent=this.urlUpdater.update(path,domain,date)}catch{}}};__name(_ArchiveController,"ArchiveController");let ArchiveController=_ArchiveController;const controller=new ArchiveController;controller.init();
//# sourceMappingURL=app.DP8cGldi.js.map
